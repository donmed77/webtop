services:
  webtop-browser:
    image: lscr.io/linuxserver/webtop:ubuntu-i3
    container_name: webtop-browser
    security_opt:
      - seccomp:unconfined
      - no-new-privileges:true
    # Security: Drop all capabilities, add only needed ones
    cap_drop:
      - ALL
    cap_add:
      - SYS_ADMIN      # Required for Chrome sandbox
      - NET_BIND_SERVICE
      - CHOWN          # Required for container init
      - SETUID         # Required for container init
      - SETGID         # Required for container init
      - DAC_OVERRIDE   # Required for file operations
    shm_size: "12gb"
    deploy:
      resources:
        limits:
          cpus: '6.0'
          memory: 12G
    environment:
      # User/System
      - PUID=1000
      - PGID=1000
      - TZ=Africa/Algiers
      - TITLE=Unshort_Link
      - LANG=en_US.UTF-8
      - LC_ALL=en_US.UTF-8
      # Selkies
      - SELKIES_UI_SHOW_SIDEBAR=true
      # Selkies Streaming Configuration
      - SELKIES_UI_TITLE=Unshort_Link
      - SELKIES_UI_SHOW_LOGO=false
      - SELKIES_UI_SIDEBAR_SHOW_GAMEPADS=false
      - SELKIES_UI_SIDEBAR_SHOW_GAMING_MODE=false
      - SELKIES_USE_BROWSER_CURSORS=true
      - SELKIES_USE_CPU=true
      - SELKIES_H264_STREAMING_MODE=true
      - SELKIES_ENABLE_RESIZE=true
      - SELKIES_AUDIO_BITRATE=128000
      # Selkies UI - Hide sidebar and file transfers
      - SELKIES_FILE_TRANSFERS=
      - SELKIES_UI_SIDEBAR_SHOW_FILES=false
      - SELKIES_UI_SIDEBAR_SHOW_APPS=false
      - SELKIES_COMMAND_ENABLED=false
      - SELKIES_ENABLE_BASIC_UI=false
      - SELKIES_BASIC_SETTINGS_ENABLE_AUDIO=true
      - SELKIES_BASIC_SETTINGS_ENABLE_CLIPBOARD=true
      # Selkies Shared
      - SELKIES_ENABLE_SHARING=true
      - SELKIES_ENABLE_COLLAB=false
      - SELKIES_ENABLE_SHARED=true
      # Disable controller sharing (Player 2/3/4)
      - SELKIES_ENABLE_PLAYER2=false
      - SELKIES_ENABLE_PLAYER3=false
      - SELKIES_ENABLE_PLAYER4=false
    volumes:
      - ./chrome-policies.json:/etc/opt/chrome/policies/managed/policies.json:ro
      - ./config:/config
      - ./scripts:/custom-cont-init.d:ro
    # tmpfs for cache and temp files (faster, memory-based)
    tmpfs:
      - /tmp:size=2G,mode=1777
    ports:
      - "3080:3000"
      - "3081:3001"
    devices:
      - /dev/dri:/dev/dri
    restart: unless-stopped
